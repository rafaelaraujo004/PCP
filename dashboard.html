<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - Controle Lavador</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='16' fill='%231d7d42'/%3E%3Ctext x='50' y='58' font-family='Inter,Arial' font-weight='700' font-size='46' text-anchor='middle' fill='white'%3EU%26M%3C/text%3E%3C/svg%3E">
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="logo">U&M</div>
      <div class="titles">
        <h1>üìà Dashboard - Controle Lavador</h1>
        <p class="subtitle">Visualiza√ß√£o de dados, estat√≠sticas e indicadores de performance</p>
      </div>
    </div>
    <div class="header-actions">
      <div class="consumo-box">
        <label for="consumoLavador">üíß Consumo Lavador</label>
        <input id="consumoLavador" type="number" step="1" min="0" placeholder="0" />
        <button id="btnSalvarConsumo" class="primary">Salvar</button>
      </div>
      <div class="theme-toggle">
        <button id="btnToggleTheme" class="ghost" title="Alternar modo claro/escuro" onclick="toggleThemeLocal()">
          <span id="themeIcon">üåô</span>
        </button>
      </div>
      <div class="navigation">
        <button id="btnVoltar" class="ghost">üè† In√≠cio</button>
        <button id="btnRegistros" class="primary">üìä Registros</button>
      </div>
    </div>
  </header>

  <main>
    <section id="dashboard-content">
      <div class="kpis">
        <div class="kpi"><div class="kpi-label">Total</div><div id="kpiTotal" class="kpi-value">0</div></div>
        <div class="kpi"><div class="kpi-label">Programados</div><div id="kpiProgramado" class="kpi-value">0</div></div>
        <div class="kpi"><div class="kpi-label">Em processo</div><div id="kpiEmProcesso" class="kpi-value">0</div></div>
        <div class="kpi"><div class="kpi-label">Finalizados</div><div id="kpiFinalizado" class="kpi-value">0</div></div>
        <div class="kpi"><div class="kpi-label">Consumo</div><div id="kpiConsumo" class="kpi-value">0</div></div>
      </div>

      <div class="charts">
        <div class="card">
          <h3>Registros por Status</h3>
          <canvas id="chartStatus" height="100"></canvas>
        </div>
        <div class="card">
          <h3>Registros por Respons√°vel</h3>
          <canvas id="chartResp" height="80"></canvas>
        </div>
        <div class="card wide">
          <h3>Finaliza√ß√µes por data (√∫ltimos 60 dias)</h3>
          <canvas id="chartLinha" height="80"></canvas>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <small>Feito em HTML, CSS e JavaScript ‚Ä¢ Dados armazenados no seu navegador (localStorage)</small>
  </footer>

  <script>
    // Teste b√°sico
    console.log('Dashboard.html carregado!');
    
    // Fun√ß√µes locais para o tema
    function toggleThemeLocal() {
      console.log('üé® Toggle theme local chamado');
      
      if (typeof toggleTheme === 'function') {
        console.log('‚úÖ Usando fun√ß√£o original do app.js');
        toggleTheme();
      } else {
        console.log('‚ö†Ô∏è Usando fun√ß√£o local');
        const root = document.documentElement;
        const themeIcon = document.getElementById('themeIcon');
        const btnTheme = document.getElementById('btnToggleTheme');
        
        if (root.classList.contains('light-theme')) {
          // Mudar para escuro
          root.classList.remove('light-theme');
          if (themeIcon) themeIcon.textContent = 'üåô';
          if (btnTheme) btnTheme.title = 'Alternar para modo claro';
          localStorage.setItem('controle-lavador-theme', 'dark');
          console.log('üåô Mudou para modo escuro');
        } else {
          // Mudar para claro
          root.classList.add('light-theme');
          if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
          if (btnTheme) btnTheme.title = 'Alternar para modo escuro';
          localStorage.setItem('controle-lavador-theme', 'light');
          console.log('‚òÄÔ∏è Mudou para modo claro');
        }
      }
    }
    
    function initThemeLocal() {
      const savedTheme = localStorage.getItem('controle-lavador-theme') || 'dark';
      const root = document.documentElement;
      const themeIcon = document.getElementById('themeIcon');
      const btnTheme = document.getElementById('btnToggleTheme');
      
      if (savedTheme === 'light') {
        root.classList.add('light-theme');
        if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
        if (btnTheme) btnTheme.title = 'Alternar para modo escuro';
      } else {
        root.classList.remove('light-theme');
        if (themeIcon) themeIcon.textContent = 'üåô';
        if (btnTheme) btnTheme.title = 'Alternar para modo claro';
      }
      
      console.log('üé® Tema inicializado (local):', savedTheme);
    }
    
    // Fun√ß√£o de teste para o tema
    window.testarTemaDashboard = function() {
      console.log('üß™ Testando tema no dashboard...');
      toggleThemeLocal();
    };
    
    // Inicializar apenas o dashboard
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM dashboard carregado!');
      
      // Inicializar tema primeiro
      initThemeLocal();
      
      // Configurar bot√µes de navega√ß√£o
      const btnVoltar = document.getElementById('btnVoltar');
      const btnRegistros = document.getElementById('btnRegistros');
      
      if (btnVoltar) {
        btnVoltar.addEventListener('click', () => {
          window.location.href = 'index.html';
        });
      }
      
      if (btnRegistros) {
        btnRegistros.addEventListener('click', () => {
          window.location.href = 'registros.html';
        });
      }
      
      // Verificar se as fun√ß√µes existem antes de chamar
      if(typeof initTheme === 'function') {
        console.log('üé® Reinicializando com app.js...');
        initTheme();
      }
      if(typeof initConsumo === 'function') initConsumo();
      if(typeof renderDashboard === 'function') renderDashboard();
    });
  </script>
</body>
</html>
